{
    "html_content": "<!DOCTYPE html>\n<html lang=\"en\">\n <head>\n  <meta charset=\"utf-8\"/>\n  <meta content=\"width=device-width, initial-scale=1\" name=\"viewport\"/>\n  <title>\n   OpenVPN + Cloak\n  </title>\n  <link href=\"../general.css\" rel=\"stylesheet\" type=\"text/css\"/>\n </head>\n <body>\n  <div id=\"header\">\n   <div class=\"content\">\n    <h2>\n     <a href=\"/\">\n      Oil and Fish\n     </a>\n    </h2>\n   </div>\n  </div>\n  <div id=\"main\">\n   <div class=\"content\">\n    <h1>\n     OpenVPN + Cloak\n    </h1>\n    <p>\n     People in not-free countries often have a problem with OpenVPN connections being blocked by government censors. This article describes a solution.\n    </p>\n    <p>\n     Cloak disguises a proxy or VPN server as a web server in order to evade deep packet inspection (DPI). The disguised server secretly implements Shadowsocks, OpenVPN, or Tor.\n    </p>\n    <p>\n     In this article, we deploy OpenVPN and Cloak on a Debian 10 server, with a camouflage website running on Nginx. It will be similar on recent versions of Ubuntu.\n    </p>\n    <p>\n     Before you set up your server:\n    </p>\n    <ul>\n     <li>\n      You will need a domain name, either free or paid\n     </li>\n     <li>\n      You will need to create a DNS\n      <code>\n       A\n      </code>\n      record pointing from your server hostname to your serverâ€™s IP address\n     </li>\n    </ul>\n    <p>\n     In the examples in this article, we give the server host name as\n     <code>\n      xxx.yyyyy.xyz\n     </code>\n     and the server IP address as\n     <code>\n      yy.yy.yy.yy\n     </code>\n     .\n    </p>\n    <p>\n     We end the tutorial by describing the procedure for setting up a Windows client. This will not work with a Linux client running Network Manager due to\n     <a href=\"https://bugzilla.redhat.com/show_bug.cgi?id=1417169\" target=\"_blank\">\n      #1417169\n     </a>\n     . Network Manager for OpenVPN does not support special route keywords such as\n     <code>\n      vpn_gateway\n     </code>\n     or\n     <code>\n      net_gateway\n     </code>\n     .\n    </p>\n    <img alt=\"From Firefox to Shadowsocks to Cloak\" src=\"../images/openvpn-cloak.png\"/>\n    <h2>\n     <a id=\"1\">\n     </a>\n     1. Set Up Camouflage Web Server\n    </h2>\n    <h3>\n     <a id=\"1-1\">\n     </a>\n     1.1. Open Firewall\n    </h3>\n    <p>\n     There are multiple ways to implement a firewall on Debian 10: nftables, iptables, ufw, and firewalld. The modern way is nftables. However, in a few minutes we are going to install OpenVPN with a script that uses iptables. Therefore we will start off by using iptables to build a basic firewall on the server. Issue these commands in turn:\n    </p>\n    <blockquote>\n     <code>\n      iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      iptables -A INPUT -i lo -j ACCEPT\n     </code>\n    </blockquote>\n    <p>\n     Accept IPv4 PING requests:\n    </p>\n    <blockquote>\n     <code>\n      iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT\n     </code>\n    </blockquote>\n    <p>\n     Open port\n     <code>\n      22\n     </code>\n     for SSH. (If you can restrict the port\n     <code>\n      22\n     </code>\n     rule so that only certain source IP addresses are whitelisted for SSH access, then so much the better.)\n    </p>\n    <blockquote>\n     <code>\n      iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n     </code>\n    </blockquote>\n    <p>\n     Add rules to open ports 80 and 443 for HTTP and HTTPS respectively:\n    </p>\n    <blockquote>\n     <code>\n      iptables -A INPUT -p tcp --dport 80 -j ACCEPT\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      iptables -A INPUT -p tcp --dport 443 -j ACCEPT\n     </code>\n    </blockquote>\n    <p>\n     Drop all unexpected input:\n    </p>\n    <blockquote>\n     <code>\n      iptables -P INPUT DROP\n     </code>\n    </blockquote>\n    <p>\n     Save the iptables rules so that they persist after reboots:\n    </p>\n    <blockquote>\n     <code>\n      apt install iptables-persistent -y\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"1-2\">\n     </a>\n     1.2. Implement BBR\n    </h3>\n    <p>\n     Bottleneck Bandwidth and Round-trip propagation time (BBR) is a TCP congestion control algorithm developed at Google. Under certain types of network congestion, it will improve your latency. Implement BBR TCP congestion control on your server with the following commands:\n    </p>\n    <blockquote>\n     <code>\n      cat &gt;&gt; /etc/sysctl.d/50-bbr.conf &lt;&lt;EOF\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      net.core.default_qdisc=fq\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      net.ipv4.tcp_congestion_control=bbr\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      EOF\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      sysctl -p /etc/sysctl.d/50-bbr.conf\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"1-3\">\n     </a>\n     1.3. Install Nginx\n    </h3>\n    <p>\n     Install the Nginx web server on your server:\n    </p>\n    <blockquote>\n     <code>\n      apt update &amp;&amp; apt upgrade -y\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      apt install nginx -y\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"1-4\">\n     </a>\n     1.4. Configure Nginx\n    </h3>\n    <p>\n     We want to make the Nginx web site look as much as possible like a realistic production server. Therefore edit the main Nginx configuration file:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/nginx/nginx.conf\n     </code>\n    </blockquote>\n    <p>\n     Uncomment the line:\n    </p>\n    <blockquote>\n     <code>\n      server_tokens off;\n     </code>\n    </blockquote>\n    <p>\n     Save the main Nginx configuration file. Then edit the default site definition file:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/nginx/sites-available/default\n     </code>\n    </blockquote>\n    <p>\n     Insert the real server name, which in our example is\n     <code>\n      xxx.yyyyy.xyz\n     </code>\n     :\n    </p>\n    <blockquote>\n     <code>\n      server_name xxx.yyyyy.xyz;\n     </code>\n    </blockquote>\n    <p>\n     Immediately below that, insert lines that will allow only expected HTTP request methods:\n    </p>\n    <pre>    if ($request_method !~ ^(GET|HEAD|POST)$ )\n    {\n            return 405;\n    }\n</pre>\n    <p>\n     Just like a real server, add a line to provide realistic browser caching:\n    </p>\n    <blockquote>\n     <code>\n      expires 1h;\n     </code>\n    </blockquote>\n    <p>\n     Save the default site definition file.\n    </p>\n    <p>\n     Restart Nginx for all your changes:\n    </p>\n    <blockquote>\n     <code>\n      nginx -t\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      systemctl restart nginx\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"1-5\">\n     </a>\n     1.5. Add Camouflage Content to Web Server\n    </h3>\n    <p>\n     Add a few realistic webpages to your camouflage site. Here is an example of how you might do that. You can add different content if you have some.\n    </p>\n    <blockquote>\n     <code>\n      apt install wget zip unzip -y\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      wget https://github.com/arcdetri/sample-blog/archive/master.zip\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      unzip master.zip\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      cp -rf sample-blog-master/html/* /var/www/html/\n     </code>\n    </blockquote>\n    <p>\n     At this point, you can test to see if your host name resolves to your IP address by opening a browser on your PC and visiting the HTTP version of your site. Using our example of a host named\n     <code>\n      xxx.yyyyy.xyz\n     </code>\n     , that would be:\n    </p>\n    <blockquote>\n     <code>\n      http://xxx.yyyyy.xyz\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"1-6\">\n     </a>\n     1.6. Add SSL Certificate to Web Server\n    </h3>\n    <p>\n     Now we make the site accessible by HTTPS on port 443, following the instructions for Nginx and Debian 10 on the\n     <a href=\"https://certbot.eff.org/\" target=\"_blank\">\n      Certbot website\n     </a>\n     .\n    </p>\n    <blockquote>\n     <code>\n      apt install certbot python-certbot-nginx -y\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      certbot --nginx\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      certbot renew --dry-run\n     </code>\n    </blockquote>\n    <p>\n     You now have a working HTTPS camouflage website with a few sample pages on it. Test this by opening a browser on your PC and visiting the HTTPS version of your site. In our example, that would be:\n    </p>\n    <blockquote>\n     <code>\n      https://xxx.yyyyy.xyz\n     </code>\n    </blockquote>\n    <h2>\n     <a id=\"2\">\n     </a>\n     2. Install OpenVPN on Server\n    </h2>\n    <h3>\n     <a id=\"2-1\">\n     </a>\n     2.1. Download Angristan OpenVPN Install Script\n    </h3>\n    <p>\n     Get the Angristan script from GitHub:\n    </p>\n    <blockquote>\n     <code>\n      wget https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh\n     </code>\n    </blockquote>\n    <p>\n     Make the script executable:\n    </p>\n    <blockquote>\n     <code>\n      chmod +x openvpn-install.sh\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"2-2\">\n     </a>\n     2.2. Run Script and Create Client\n    </h3>\n    <p>\n     Run the script:\n    </p>\n    <blockquote>\n     <code>\n      ./openvpn-install.sh\n     </code>\n    </blockquote>\n    <p>\n     In most cases, you can accept the suggested default answers to the questions:\n    </p>\n    <ol>\n     <li>\n      IP address should accurately reflect the IP address of your server\n     </li>\n     <li>\n      Port choice should be\n      <code>\n       1194\n      </code>\n      (the default)\n     </li>\n     <li>\n      Protocol should be\n      <code>\n       UDP\n      </code>\n      (the default)\n     </li>\n     <li>\n      For DNS servers, you can choose your favorites, e.g. Cloudflare or Google\n     </li>\n     <li>\n      For enable compression, recommend\n      <code>\n       n\n      </code>\n      for no (the default)\n     </li>\n     <li>\n      For customized encryption settings, recommend\n      <code>\n       n\n      </code>\n      for no (the default)\n     </li>\n    </ol>\n    <p>\n     After answering all the questions, press any key to continue and run the script.\n    </p>\n    <ol>\n     <li>\n      For the first client name, we will put\n      <code>\n       windows10\n      </code>\n     </li>\n     <li>\n      For the private key file, select option\n      <code>\n       1\n      </code>\n      , passwordless (the default)\n     </li>\n    </ol>\n    <p>\n     You can check that OpenVPN is running already:\n    </p>\n    <blockquote>\n     <code>\n      systemctl status openvpn@server\n     </code>\n    </blockquote>\n    <p>\n     If necessary, type\n     <code>\n      q\n     </code>\n     to quit the status display.\n    </p>\n    <p>\n     Check that OpenVPN is listening for UDP input on port 1194:\n    </p>\n    <blockquote>\n     <code>\n      ss -tulpn | grep 1194\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"2-3\">\n     </a>\n     2.3. Adjust Firewall Rules\n    </h3>\n    <p>\n     Take a look at the iptables firewall after running the script:\n    </p>\n    <blockquote>\n     <code>\n      iptables -vnL\n     </code>\n    </blockquote>\n    <p>\n     You will see that the script has opened port 1194 to the public.\n    </p>\n    <p>\n     We want to make the OpenVPN server as invisible as possible. Therefore we will close port 1194 to the public. (In a few minutes, weâ€™ll add Cloak to pass incoming traffic to OpenVPN on the loopback interface port 1194.)\n    </p>\n    <p>\n     Edit the iptables rules that get added when OpenVPN is brought up:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/iptables/add-openvpn-rules.sh\n     </code>\n    </blockquote>\n    <p>\n     Delete the line that inserts an input rule accepting UDP packets on port 1194. Save the file.\n    </p>\n    <p>\n     Edit the iptables rules that get removed when OpenVPN is brought down:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/iptables/rm-openvpn-rules.sh\n     </code>\n    </blockquote>\n    <p>\n     Delete the line deleting the input rule accepting UDP packets on port 1194. Save the file.\n    </p>\n    <p>\n     The easiest way to implement this right now is to reboot the server:\n    </p>\n    <blockquote>\n     <code>\n      reboot\n     </code>\n    </blockquote>\n    <p>\n     After rebooting, SSH into your server again, and check the revised iptables rules:\n    </p>\n    <blockquote>\n     <code>\n      iptables -vnL\n     </code>\n    </blockquote>\n    <p>\n     You should see that port 1194 is no longer open to the public. Traffic that is passed from Cloak to OpenVPN will be accepted, though, since it uses the loopback interface (\n     <code>\n      lo\n     </code>\n     ), for which we added a special iptables rule at the beginning.\n    </p>\n    <h2>\n     <a id=\"3\">\n     </a>\n     3. Install Cloak on Server\n    </h2>\n    <h3>\n     <a id=\"3-1\">\n     </a>\n     3.1. Move HTTPS Site to Port 8443\n    </h3>\n    <p>\n     Right now, Nginx is listening on ports 80 and 443. Weâ€™re going to make Cloak listen on port 443, so weâ€™ll move Nginx and make it listen on port 8443 instead.\n    </p>\n    <p>\n     Edit the Nginx default site definition file:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/nginx/sites-available/default\n     </code>\n    </blockquote>\n    <p>\n     Change the lines that make the SSL server listen on port 443 to make it listen on port 8443:\n    </p>\n    <blockquote>\n     <code>\n      listen [::]:8443 ssl ipv6only=on; # managed by Certbot\n      <br/>\n      listen 8443 ssl; # managed by Certbot\n     </code>\n    </blockquote>\n    <p>\n     Save the default site definition file. Restart Nginx to make this change take effect:\n    </p>\n    <blockquote>\n     <code>\n      systemctl restart nginx\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"3-2\">\n     </a>\n     3.2. Download Cloak\n    </h3>\n    <p>\n     Open a browser on your PC and visit the\n     <a href=\"https://github.com/cbeuw/Cloak/releases\" target=\"_blank\">\n      GitHub Cloak releases page\n     </a>\n     . Determine the version number of the latest release. For example, right now it is\n     <code>\n      2.5.4\n     </code>\n     .\n    </p>\n    <p>\n     On your server, download the latest binary for 64-bit Linux:\n    </p>\n    <blockquote>\n     <code>\n      wget https://github.com/cbeuw/Cloak/releases/download/v2.5.4/ck-server-linux-amd64-v2.5.4\n     </code>\n    </blockquote>\n    <p>\n     Copy the binary into a directory in your path with the name\n     <code>\n      ck-server\n     </code>\n     :\n    </p>\n    <blockquote>\n     <code>\n      cp ck-server-linux-amd64-v2.5.4 /usr/local/bin/ck-server\n     </code>\n    </blockquote>\n    <p>\n     Make\n     <code>\n      ck-server\n     </code>\n     executable:\n    </p>\n    <blockquote>\n     <code>\n      chmod +x /usr/local/bin/ck-server\n     </code>\n    </blockquote>\n    <p>\n     Allow Cloak to bind to privileged ports (i.e. TCP/IP port numbers below 1024):\n    </p>\n    <blockquote>\n     <code>\n      setcap CAP_NET_BIND_SERVICE=+eip /usr/local/bin/ck-server\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"3-3\">\n     </a>\n     3.3. Generate Public-Private Key Pair\n    </h3>\n    <p>\n     Generate a public-private key pair:\n    </p>\n    <blockquote>\n     <code>\n      ck-server -k\n     </code>\n    </blockquote>\n    <p>\n     The public key and private key are delivered, separated by a comma. Here is an example of what the result might look like:\n    </p>\n    <blockquote>\n     <code>\n      eRx9vO3x8i1hJ9PucrnlUsN74J/g7MPLymUJCrrQJVM=,MF2tHiGXjP3P3fIIxjt02un2G0qtXdbArmrWsTfz7FM=\n     </code>\n    </blockquote>\n    <ul>\n     <li>\n      The base-64 string\n      <em>\n       before\n      </em>\n      the comma is the\n      <em>\n       public\n      </em>\n      key, to be given to users\n     </li>\n     <li>\n      The base-64 string\n      <em>\n       after\n      </em>\n      the comma is the\n      <em>\n       private\n      </em>\n      key, to be kept on the server\n     </li>\n    </ul>\n    <h3>\n     <a id=\"3-4\">\n     </a>\n     3.4. Generate Administrator Id\n    </h3>\n    <p>\n     Generate a secret identifier for the administrator like this:\n    </p>\n    <blockquote>\n     <code>\n      ck-server -u\n     </code>\n    </blockquote>\n    <p>\n     It will produce a base-64 string that looks like this:\n    </p>\n    <blockquote>\n     <code>\n      SI6bHNp9+Mlc0+/LxhhYig==\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"3-5\">\n     </a>\n     3.5. Generate User Id\n    </h3>\n    <p>\n     Generate an identifier for an ordinary user. We will make this user have no bandwidth or credit limit restrictions.\n    </p>\n    <blockquote>\n     <code>\n      ck-server -u\n     </code>\n    </blockquote>\n    <p>\n     The command will produce a base-64 string that looks like this:\n    </p>\n    <blockquote>\n     <code>\n      lNEQtGxl6BgYmVg9N5kBRA==\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"3-6\">\n     </a>\n     3.6. Configure Cloak\n    </h3>\n    <p>\n     For your reference, there is a\n     <a href=\"https://github.com/cbeuw/Cloak/blob/master/example_config/ckserver.json\" target=\"_blank\">\n      sample configuration file on GitHub\n     </a>\n     .\n    </p>\n    <p>\n     Create a directory for Cloak:\n    </p>\n    <blockquote>\n     <code>\n      mkdir /etc/cloak\n     </code>\n    </blockquote>\n    <p>\n     Edit your serverâ€™s configuration file for Cloak:\n    </p>\n    <blockquote>\n     <code>\n      vi /etc/cloak/ckserver.json\n     </code>\n    </blockquote>\n    <p>\n     Insert contents like the example below, substituting in your user id, private key, and administrator id:\n    </p>\n    <pre>{\n  \"ProxyBook\": {\n    \"openvpn\": [\n      \"udp\",\n      \"127.0.0.1:1194\"\n    ]\n  },\n  \"BindAddr\": [\n    \":443\"\n  ],\n  \"BypassUID\": [\n    \"lNEQtGxl6BgYmVg9N5kBRA==\"\n  ],\n  \"RedirAddr\": \"127.0.0.1:8443\",\n  \"PrivateKey\": \"MF2tHiGXjP3P3fIIxjt02un2G0qtXdbArmrWsTfz7FM=\",\n  \"AdminUID\": \"SI6bHNp9+Mlc0+/LxhhYig==\",\n  \"DatabasePath\": \"/etc/cloak/userinfo.db\",\n  \"StreamTimeout\": 300\n}</pre>\n    <ul>\n     <li>\n      <code>\n       ProxyBook\n      </code>\n      tells Cloak where to forward authenticated proxy traffic to, which for us is OpenVPN on port\n      <code>\n       1194\n      </code>\n     </li>\n     <li>\n      <code>\n       BindAddr\n      </code>\n      is a list of addresses Cloak will bind and listen to, which for us is\n      <code>\n       443\n      </code>\n     </li>\n     <li>\n      <code>\n       BypassUID\n      </code>\n      is a list of UIDs that are authorised without any bandwidth or credit limit restrictions\n     </li>\n     <li>\n      <code>\n       RedirAddr\n      </code>\n      is the redirection address when the incoming traffic is not from an authenticated Cloak client\n     </li>\n     <li>\n      <code>\n       PrivateKey\n      </code>\n      is the static curve25519 Diffie-Hellman private key encoded in base-64\n     </li>\n     <li>\n      <code>\n       AdminUID\n      </code>\n      is the user id of the admin user in base-64\n     </li>\n     <li>\n      <code>\n       DatabasePath\n      </code>\n      is the path to\n      <code>\n       userinfo.db\n      </code>\n      (if\n      <code>\n       userinfo.db\n      </code>\n      doesnâ€™t exist in this directory, Cloak will create one automatically)\n     </li>\n     <li>\n      <code>\n       StreamTimeout\n      </code>\n      is the number of seconds of no sent data after which the incoming Cloak client connection will be terminated\n     </li>\n    </ul>\n    <p>\n     Save the Cloak server configuration file.\n    </p>\n    <h3>\n     <a id=\"3-7\">\n     </a>\n     3.7. Configure Systemd for Cloak\n    </h3>\n    <p>\n     Create a systemd service file, so that we can make Cloak start after every reboot and run continually as a service:\n    </p>\n    <blockquote>\n     <code>\n      vi /usr/lib/systemd/system/cloak.service\n     </code>\n    </blockquote>\n    <p>\n     Insert contents like this:\n    </p>\n    <blockquote>\n     <code>\n      [Unit]\n      <br/>\n      Description=Cloak Server\n      <br/>\n      After=network.target\n      <br/>\n      <br/>\n      [Service]\n      <br/>\n      Type=simple\n      <br/>\n      ExecStart=/usr/local/bin/ck-server -c /etc/cloak/ckserver.json\n      <br/>\n      Restart=on-failure\n      <br/>\n      <br/>\n      [Install]\n      <br/>\n      WantedBy=multi-user.target\n     </code>\n    </blockquote>\n    <p>\n     Save the file.\n    </p>\n    <h3>\n     <a id=\"3-8\">\n     </a>\n     3.8. Run Cloak\n    </h3>\n    <p>\n     Make Cloak start after every reboot and run continually as a service:\n    </p>\n    <blockquote>\n     <code>\n      systemctl enable cloak\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      systemctl start cloak\n     </code>\n    </blockquote>\n    <p>\n     Check the status of the Cloak service:\n    </p>\n    <blockquote>\n     <code>\n      systemctl status cloak\n     </code>\n    </blockquote>\n    <p>\n     The above command should show that Cloak is\n     <code>\n      active (running)\n     </code>\n     .\n    </p>\n    <blockquote>\n     <code>\n      ss -tulpn | grep 443\n     </code>\n    </blockquote>\n    <p>\n     The above command should show that:\n    </p>\n    <ul>\n     <li>\n      <code>\n       ck-server\n      </code>\n      is listening on port\n      <code>\n       443\n      </code>\n     </li>\n     <li>\n      <code>\n       nginx\n      </code>\n      is listening in port\n      <code>\n       8443\n      </code>\n     </li>\n    </ul>\n    <p>\n     Your work on the server is done for now, so exit your SSH session with the server:\n    </p>\n    <blockquote>\n     <code>\n      exit\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"3-9\">\n     </a>\n     3.9. Check from PC\n    </h3>\n    <p>\n     From your PC, check what an unauthorized visitor to your server would see. In our example, the address to put into your browser would be:\n    </p>\n    <blockquote>\n     <code>\n      https://xxx.yyyyy.xyz\n     </code>\n    </blockquote>\n    <p>\n     You should see an ordinary looking website.\n    </p>\n    <h2>\n     <a id=\"4\">\n     </a>\n     4. Set Up Windows 10 Client\n    </h2>\n    <p>\n     Now work on your PC, which in this tutorial is running Windows 10.\n    </p>\n    <h3>\n     <a id=\"4-1\">\n     </a>\n     4.1. Download Cloak Client\n    </h3>\n    <p>\n     In Firefox or whatever browser you are using, go to\n     <a href=\"https://github.com/cbeuw/Cloak/releases\" target=\"_blank\">\n      GitHub\n     </a>\n     and determine the latest version of Cloak. We will use version\n     <code>\n      2.5.4\n     </code>\n     as our example.\n    </p>\n    <p>\n     Still in your browser, download\n     <code>\n      ck-client-windows-amd64-2.5.4.exe\n     </code>\n     from GitHub to your PCâ€™s\n     <code>\n      Downloads\n     </code>\n     directory.\n    </p>\n    <h3>\n     <a id=\"4-2\">\n     </a>\n     4.2. Configure Cloak Client\n    </h3>\n    <p>\n     For your reference, there is a sample client configuration file on\n     <a href=\"https://github.com/cbeuw/Cloak/blob/master/example_config/ckclient.json\" target=\"_blank\">\n      GitHub\n     </a>\n     . Create your clientâ€™s configuration file for Cloak,\n     <code>\n      ckclient.json\n     </code>\n     , in the same folder as your executable download.\n    </p>\n    <p>\n     Insert contents like the example below, substituting in your user id, public key, and hostname:\n    </p>\n    <pre>{\n  \"Transport\": \"direct\",\n  \"ProxyMethod\": \"openvpn\",\n  \"EncryptionMethod\": \"aes-gcm\",\n  \"UID\": \"lNEQtGxl6BgYmVg9N5kBRA==\",\n  \"PublicKey\": \"eRx9vO3x8i1hJ9PucrnlUsN74J/g7MPLymUJCrrQJVM=\",\n  \"ServerName\": \"xxx.yyyyy.xyz\",\n  \"NumConn\": 4,\n  \"BrowserSig\": \"firefox\",\n  \"StreamTimeout\": 300\n}</pre>\n    <ul>\n     <li>\n      <code>\n       Transport\n      </code>\n      can be either direct or CDN\n     </li>\n     <li>\n      <code>\n       ProxyMethod\n      </code>\n      is the name of the proxy method you are using\n     </li>\n     <li>\n      <code>\n       EncryptionMethod\n      </code>\n      is the name of the encryption algorithm you want Cloak to use, over and above the encryption in the proxy method (we use\n      <code>\n       aes-gcm\n      </code>\n      here because OpenVPN has such a unqiue fingerprint)\n     </li>\n     <li>\n      <code>\n       UID\n      </code>\n      is your user id in base-64\n     </li>\n     <li>\n      <code>\n       PublicKey\n      </code>\n      is the static curve25519 public key, given by the server admin\n     </li>\n     <li>\n      <code>\n       ServerName\n      </code>\n      is the domain you want to make your ISP or firewall think you are visiting\n     </li>\n     <li>\n      <code>\n       NumConn\n      </code>\n      is the amount of underlying TCP connections you want to use\n     </li>\n     <li>\n      <code>\n       BrowserSig\n      </code>\n      is the browser you want to appear to be using\n     </li>\n     <li>\n      <code>\n       StreamTimeout\n      </code>\n      is the number of seconds of no sent data after which the incoming proxy connection will be terminated\n     </li>\n    </ul>\n    <p>\n     Save the file.\n    </p>\n    <h3>\n     <a id=\"4-3\">\n     </a>\n     4.3. Install OpenVPN Client\n    </h3>\n    <p>\n     Download the OpenVPN for Windows installer from the\n     <a href=\"https://openvpn.net/community-downloads/\" target=\"_blank\">\n      OpenVPN community downloads\n     </a>\n     page.\n    </p>\n    <p>\n     Run the downloaded installer to install OpenVPN on your Windows client.\n    </p>\n    <h3>\n     <a id=\"4-4\">\n     </a>\n     4.4. Download OVPN File\n    </h3>\n    <p>\n     In your home directory\n     <em>\n      on the server\n     </em>\n     , you have a file\n     <code>\n      windows10.ovpn\n     </code>\n     that you created earlier.\n    </p>\n    <p>\n     On your Windows PC, open a Windows Command prompt (\n     <strong>\n      Win\n     </strong>\n     +\n     <strong>\n      r\n     </strong>\n     , then\n     <code>\n      cmd\n     </code>\n     ).\n    </p>\n    <p>\n     Download that file from the server to the client. The command below assumes you are using\n     <a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/\" target=\"_blank\">\n      PuTTY\n     </a>\n     and its accompanying utilities. Substitute in your actual server hostname for\n     <code>\n      xxx.yyyyy.xyz\n     </code>\n     in the command:\n    </p>\n    <blockquote>\n     <code>\n      \"C:\\Program Files\\PuTTY\\pscp.exe\" -P 22 \"root@xxx.yyyyy.xyz:windows10.ovpn\" \"Downloads\\windows10.ovpn\"\n     </code>\n    </blockquote>\n    <h3>\n     <a id=\"4-5\">\n     </a>\n     4.5. Edit OVPN File\n    </h3>\n    <p>\n     In a text editor such as Notepad or Notepad++, edit the file\n     <code>\n      windows10.ovpn\n     </code>\n     you just downloaded. Change the remote server to\n     <code>\n      127.0.0.1\n     </code>\n     port\n     <code>\n      1984\n     </code>\n     like this:\n    </p>\n    <blockquote>\n     <code>\n      remote 127.0.0.1 1984\n     </code>\n    </blockquote>\n    <p>\n     Also add a line, replacing\n     <code>\n      yy.yy.yy.yy\n     </code>\n     with your actual server IP address:\n    </p>\n    <blockquote>\n     <code>\n      route yy.yy.yy.yy 255.255.255.255 net_gateway\n     </code>\n    </blockquote>\n    <img alt=\"OpenVPN client configuration for Cloak\" src=\"../images/oc-ovpn-file.png\"/>\n    <p>\n     Save the file\n     <code>\n      windows10.ovpn\n     </code>\n     .\n    </p>\n    <h3>\n     <a id=\"4-6\">\n     </a>\n     4.6. Import VPN to OpenVPN GUI\n    </h3>\n    <p>\n     From your Windows desktop, start the OpenVPN GUI.\n    </p>\n    <p>\n     Right-click on its icon in the system tray, and select the item to import the amended OVPN file\n     <code>\n      windows10.ovpn\n     </code>\n     .\n    </p>\n    <h3>\n     <a id=\"4-7\">\n     </a>\n     4.7. Run Cloak\n    </h3>\n    <p>\n     Open a Windows Command Prompt. Issue the commands that follow, replacing\n     <code>\n      yy.yy.yy.yy\n     </code>\n     by your actual server IP address:\n    </p>\n    <blockquote>\n     <code>\n      cd Downloads\n     </code>\n    </blockquote>\n    <blockquote>\n     <code>\n      ck-client-windows-amd64-v2.5.4.exe -u -c ckclient.json -s yy.yy.yy.yy\n     </code>\n    </blockquote>\n    <p>\n     Leave the Command Prompt window open with Cloak client running in it.\n    </p>\n    <h3>\n     <a id=\"4-8\">\n     </a>\n     4.8. Run OpenVPN\n    </h3>\n    <p>\n     Right-click on the OpenVPN icon in the system tray, and select the item to connect to\n     <code>\n      windows10.ovpn\n     </code>\n    </p>\n    <h3>\n     <a id=\"4-9\">\n     </a>\n     4.9. End-to-End Test\n    </h3>\n    <p>\n     Check the end-to-end functionality to confirm that OpenVPN and Cloak are configured correctly. In Firefox or whatever browser you are using, visit\n     <a href=\"https://ipchicken.com\" target=\"_blank\">\n      IP Chicken\n     </a>\n     . You should see the IP address of the server, not your local client.\n    </p>\n    <h2>\n     <a id=\"5\">\n     </a>\n     5. Get Help and Report Issues\n    </h2>\n    <ul>\n     <li>\n      You can find out more about Cloak in the\n      <a href=\"https://github.com/cbeuw/Cloak/blob/master/README.md\" target=\"_blank\">\n       README on GitHub\n      </a>\n     </li>\n     <li>\n      You can ask general questions about Cloak on\n      <a href=\"https://ntc.party/c/community-software/cloak/21\" target=\"_blank\">\n       ntc.party\n      </a>\n     </li>\n     <li>\n      For Cloak issues, post in the\n      <strong>\n       Issues\n      </strong>\n      section for\n      <a href=\"https://github.com/cbeuw/Cloak/issues\" target=\"_blank\">\n       Cloak on GitHub\n      </a>\n     </li>\n     <li>\n      For OpenVPN questions, post in the\n      <a href=\"https://forums.openvpn.net\" target=\"_blank\">\n       OpenVPN forum\n      </a>\n     </li>\n    </ul>\n    <p>\n     <em>\n      Updated 2021-06-19\n     </em>\n    </p>\n   </div>\n  </div>\n  <div id=\"footer\">\n   <div class=\"content\">\n    <p>\n     This site is provided for information only. It cannot replace the advice of a trained security professional. If lives or safety depend on your security, please seek the advice of an expert.\n    </p>\n   </div>\n  </div>\n </body>\n</html>\n"
}